name: Test Build Only

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

env:
  REGISTRY: ghcr.io
  IMAGE_NAME: ${{ github.repository }}

jobs:
  quick-build-test:
    runs-on: ubuntu-latest
    timeout-minutes: 10  # –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build Backend
      run: |
        cd backend
        docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-backend:test .
        echo "‚úÖ Backend built successfully"
    
    - name: Build Frontend
      run: |
        cd frontend
        docker build -t ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-frontend:test .
        echo "‚úÖ Frontend built successfully"
    
    - name: Quick Backend Test
      run: |
        # –ë—ã—Å—Ç—Ä—ã–π —Ç–µ—Å—Ç –±–µ–∑ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
        docker run --rm ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-backend:test python -c "
        print('üß™ Quick backend test...')
        
        # –¢–æ–ª—å–∫–æ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∏–º–ø–æ—Ä—Ç—ã
        import app.models
        import app.schemas
        import app.crud
        
        from app.models import User, Course
        from app.schemas import UserCreate, CourseCreate
        
        print('‚úÖ All safe imports work')
        print('‚úÖ Models: User, Course')
        print('‚úÖ Schemas: UserCreate, CourseCreate')
        print('üéâ Quick test passed!')
        "
    
    - name: Quick Frontend Test
      run: |
        docker run --rm ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-frontend:test nginx -t
        echo "‚úÖ Frontend nginx config is valid"
    
    - name: Cleanup
      run: |
        # –û—á–∏—â–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã
        docker rmi ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-backend:test || true
        docker rmi ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}-frontend:test || true
        echo "üßπ Test images cleaned up"